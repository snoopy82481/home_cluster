# {{ ansible_managed }}
# This configuration file is generated by Ansible.

service {
    dns {
        forwarding {
            listen-on eth0
            cache-size 0
            name-server 8.8.8.8
            name-server 8.8.4.4
        }
    }
}

interfaces {
    ethernet eth0 {
        address {{ wan_address }}
        description WAN
        duplex auto
        speed auto
    }

    ethernet eth1 {
        address {{ lan_address }}
        description LAN
        duplex auto
        speed auto
    }

    loopback lo {
    }

    bridge br0 {
        address {{ management_address }}
        description Management
        member {
            interface eth1
        }
    }
}

protocols {
    static {
        route 0.0.0.0/0 {
            next-hop {{ default_gateway }}
        }
    }
}

firewall {
    all-ping enable
    broadcast-ping disable
    ipv6-receive-redirects disable
    ipv6-src-route disable
    ip-src-route disable
    log-martians enable
    name WAN-IN {
        default-action drop
        rule 10 {
            action accept
            state {
                established enable
                related enable
            }
        }
        rule 20 {
            action drop
        }
    }
    receive-redirects disable
    send-redirects enable
    source-validation disable
    syn-cookies enable
}

nat {
    destination {
        rule 10 {
            destination {
                port 80,443
            }
            inbound-interface eth0
            protocol tcp
            translation {
                address {{ web_server_ip }}
                port 80,443
            }
        }
    }
}

dhcp-server {
    disabled false
    shared-network-name LAN {
        authoritative enable
        subnet {{ lan_subnet }} {
            default-router {{ lan_gateway }}
            dns-server {{ dns_servers }}
            lease {
                start 192.168.100.100
                stop 192.168.100.200
                time 12h
            }
            range 192.168.100.100 192.168.100.200
        }
    }
}
